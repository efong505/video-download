<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Fireworks Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');
        
        .margin-b-2 {
            margin-bottom: 2rem;
        }
        
        /* Custom CSS for the night sky look and responsive canvas */
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100%;
            width: 100%;
            background-color: #0d0c1d; /* Deep indigo/black for night sky */
            font-family: 'Orbitron', sans-serif;
            color: #fff;
        }

        

        canvas {
            display: block;
            touch-action: none; /* Prevents default touch actions on canvas */
        }

        #info-box {
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(10, 10, 20, 0.7);
            padding: 12px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            border: 2px solid #555;
            text-align: center;
            font-size: 0.9rem;
            letter-spacing: 1px;
            z-index: 10;
        }

        
    </style>
</head>
<body>


    <div class="text-center">
        <h1 class="mt-9" id="nav-links">
            <a href="videos.html" rel="noopener noreferrer" class="mr-8">üé¨ Videos</a>
            <a href="articles.html" rel="noopener noreferrer" class="mr-8">üìù Articles</a>
            <a href="login.html" rel="noopener noreferrer" class="ml-8">Login</a>
        </h1>
    </div>

    <div id="info-box" class="mt-12">
        <p class="text-yellow-400 font-bold">Click or Tap Anywhere to Launch a Firework!</p>
        <p class="text-sm mt-1 text-gray-300">Just for fun... Enjoy the show.</p>
    </div>
    
    <canvas id="fireworksCanvas"></canvas>

    <script>
        // --- Setup and Constants ---
        const canvas = document.getElementById('fireworksCanvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        
        // Physics constants
        const GRAVITY = 0.05;
        const FIREWORK_SPEED = 5;
        const FRICTION = 0.99;
        const PARTICLE_COUNT = 50;

        // Arrays to hold all active fireworks and particles
        const fireworks = [];
        const particles = [];

        // --- Utility Functions ---

        /**
         * Converts HSL (Hue, Saturation, Lightness) to a CSS color string.
         * @param {number} h Hue (0-360)
         * @param {number} s Saturation (0-100)
         * @param {number} l Lightness (0-100)
         * @param {number} a Alpha (0-1)
         * @returns {string} CSS color string (e.g., "hsla(120, 80%, 50%, 1)")
         */
        function hsla(h, s, l, a) {
            return `hsla(${h}, ${s}%, ${l}%, ${a})`;
        }

        /**
         * Gets a random vibrant color (high saturation, medium lightness).
         * @returns {object} Object containing hue (h) and color string (c).
         */
        function getRandomColor() {
            const h = Math.random() * 360;
            const c = hsla(h, 70, 60, 1);
            return { h, c };
        }

        // --- Particle Class (The Sparks) ---
        class Particle {
            constructor(x, y, hue, velocity) {
                this.x = x;
                this.y = y;
                this.hue = hue;
                this.color = hsla(this.hue, 80, 50, 1);
                this.velocity = velocity;
                
                // Track previous position for trail effect
                this.prevX = x;
                this.prevY = y;
                
                // Life and fading
                this.life = 1; // 100% life
                this.decay = Math.random() * 0.015 + 0.005; 
                this.size = Math.random() * 2 + 1;
            }

            update() {
                // Apply friction and gravity
                this.velocity.x *= FRICTION;
                this.velocity.y *= FRICTION;
                this.velocity.y += GRAVITY;

                // Update position
                this.prevX = this.x;
                this.prevY = this.y;
                this.x += this.velocity.x;
                this.y += this.velocity.y;

                // Decay and check for death
                this.life -= this.decay;
                return this.life > 0;
            }

            draw() {
                ctx.beginPath();
                // Draw a small line from previous to current position for trail
                ctx.moveTo(this.prevX, this.prevY);
                ctx.lineTo(this.x, this.y);
                
                // Set the color with decreasing alpha based on life
                ctx.strokeStyle = hsla(this.hue, 80, 50, this.life);
                ctx.lineWidth = this.size;
                ctx.stroke();
            }
        }

        // --- Firework Class (The Rocket) ---
        class Firework {
            constructor(startX, startY, targetX, targetY) {
                this.x = startX;
                this.y = startY;
                this.startX = startX;
                this.startY = startY;
                this.targetX = targetX;
                this.targetY = targetY;

                // Calculate distance and angle
                const dx = targetX - startX;
                const dy = targetY - startY;
                const dist = Math.sqrt(dx * dx + dy * dy);

                // Velocity components
                this.velocity = {
                    x: (dx / dist) * FIREWORK_SPEED,
                    y: (dy / dist) * FIREWORK_SPEED,
                };
                
                this.distanceTraveled = 0;
                this.distanceToTarget = dist;
                
                const color = getRandomColor();
                this.hue = color.h;
                this.color = color.c;
            }

            update() {
                // Apply gravity to the rocket
                this.velocity.y += GRAVITY * 0.5;

                // Track previous position for the rocket trail
                const prevX = this.x;
                const prevY = this.y;

                // Update position
                this.x += this.velocity.x;
                this.y += this.velocity.y;
                
                // Calculate new distance traveled
                const distChange = Math.sqrt((this.x - prevX)**2 + (this.y - prevY)**2);
                this.distanceTraveled += distChange;

                // Check if the firework should explode (reached its peak/target)
                if (this.distanceTraveled >= this.distanceToTarget || this.y < this.targetY) {
                    this.explode();
                    return false; // Signal that this firework should be removed
                }
                
                return true; // Keep the firework alive
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
            }

            explode() {
                // Create many particles in a circular/spherical pattern
                for (let i = 0; i < PARTICLE_COUNT; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = Math.random() * 4 + 1;

                    const velocity = {
                        x: Math.cos(angle) * speed,
                        y: Math.sin(angle) * speed,
                    };
                    particles.push(new Particle(this.x, this.y, this.hue, velocity));
                }
            }
        }
        
        // --- Initialization and Event Handlers ---
        
        function resizeCanvas() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        }

        /**
         * Adds a new firework launching from the bottom center to the clicked target.
         * @param {number} x X-coordinate of the click/tap
         * @param {number} y Y-coordinate of the click/tap
         */
        function launchFirework(x, y) {
            const startX = width / 2;
            const startY = height;
            
            // Adjust target Y slightly higher than the click point to ensure explosion
            const targetY = y - 50; 
            
            fireworks.push(new Firework(startX, startY, x, targetY));
        }

        // Handle both mouse clicks and touch taps
        function handleInteraction(event) {
            let clientX, clientY;

            if (event.type === 'touchstart') {
                event.preventDefault(); // Stop scrolling/zooming
                clientX = event.touches[0].clientX;
                clientY = event.touches[0].clientY;
            } else if (event.type === 'click') {
                clientX = event.clientX;
                clientY = event.clientY;
            }
            
            if (clientX !== undefined) {
                launchFirework(clientX, clientY);
            }
        }
        
        canvas.addEventListener('click', handleInteraction);
        canvas.addEventListener('touchstart', handleInteraction);
        window.addEventListener('resize', resizeCanvas);


        // --- Game Loop (Animate) ---

        function animate() {
            // Request the next frame
            requestAnimationFrame(animate);

            // 1. Fade out the previous frame to create trails and a dark sky effect
            // A low alpha value (0.1) creates long, smoky trails
            ctx.fillStyle = 'rgba(13, 12, 29, 0.1)'; 
            ctx.fillRect(0, 0, width, height);
            
            // 2. Update and draw fireworks (the rockets)
            for (let i = fireworks.length - 1; i >= 0; i--) {
                const isAlive = fireworks[i].update();
                if (isAlive) {
                    fireworks[i].draw();
                } else {
                    // Remove exploded firework
                    fireworks.splice(i, 1);
                }
            }

            // 3. Update and draw particles (the explosion sparks)
            for (let i = particles.length - 1; i >= 0; i--) {
                const isAlive = particles[i].update();
                if (isAlive) {
                    particles[i].draw();
                } else {
                    // Remove dead particle
                    particles.splice(i, 1);
                }
            }
        }

        // Start the application
        window.onload = function () {
            // Check authentication and update navigation
            const token = localStorage.getItem('auth_token');
            const userData = localStorage.getItem('user_data');
            const navLinks = document.getElementById('nav-links');
            
            if (token && userData) {
                try {
                    const user = JSON.parse(userData);
                    // User is logged in - show logout and admin link if admin
                    let newNav = navLinks.innerHTML.replace(
                        '<a href="login.html" rel="noopener noreferrer" class="ml-8">Login</a>',
                        '<a href="#" onclick="logout()" rel="noopener noreferrer" class="ml-8">Logout</a>'
                    );
                    
                    if (user.role === 'admin') {
                        newNav = newNav.replace(
                            'Go To My Videos</a>',
                            'Go To My Videos</a>\n            <a href="admin.html" rel="noopener noreferrer" class="mr-8">Admin Dashboard</a>'
                        );
                    }
                    
                    navLinks.innerHTML = newNav;
                } catch (error) {
                    console.log('Error parsing user data');
                }
            }
            
            resizeCanvas();
            animate();
        }
        
        function logout() {
            localStorage.removeItem('auth_token');
            localStorage.removeItem('user_data');
            window.location.reload();
        }

    </script>
</body>
</html>